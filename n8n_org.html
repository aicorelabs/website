<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n - whatsapp Capacity Calculator - Real-Time Shift Matching at Scale</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Sora:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-dark: #0a0e17;
            --bg-card: #141824;
            --bg-input: #1a1f2e;
            --accent-primary: #00ff88;
            --accent-secondary: #00ccff;
            --accent-warning: #ffaa00;
            --accent-danger: #ff4444;
            --text-primary: #ffffff;
            --text-secondary: #8b92a7;
            --text-muted: #4a5568;
            --border: #2d3748;
            --shadow: rgba(0, 255, 136, 0.1);
        }
        
        body {
            font-family: 'Sora', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 204, 255, 0.05) 0%, transparent 50%);
            padding: 2rem;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 2rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input[type="number"],
        select {
            width: 100%;
            padding: 1rem;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }
        
        .select-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Sora', sans-serif;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .select-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }
        
        /* Slider Styles */
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--bg-input);
            outline: none;
            -webkit-appearance: none;
            margin: 1rem 0;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
        }
        
        .value-display {
            float: right;
            background: var(--accent-primary);
            color: var(--bg-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .example {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(0, 255, 136, 0.05);
            border-left: 2px solid var(--accent-primary);
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        /* Formula Visualization */
        .formula-section {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 204, 255, 0.05));
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .formula-title {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--accent-secondary);
            font-weight: 600;
            text-align: center;
        }
        
        .formula-flow {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .formula-step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .formula-label {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .formula-calc {
            flex: 2;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            color: var(--text-primary);
            padding: 0.75rem;
            background: var(--bg-input);
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .formula-result {
            flex: 1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-primary);
            text-align: right;
        }
        
        .formula-arrow {
            text-align: center;
            color: var(--accent-secondary);
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .help-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric {
            background: var(--bg-input);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .metric:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-primary);
        }
        
        .metric-unit {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-left: 0.5rem;
        }
        
        .plan-comparison {
            margin-top: 2rem;
        }
        
        .plan-card {
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .plan-card.recommended {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 136, 0.05);
        }
        
        .plan-card.warning {
            border-color: var(--accent-warning);
            background: rgba(255, 170, 0, 0.05);
        }
        
        .plan-card.danger {
            border-color: var(--accent-danger);
            background: rgba(255, 68, 68, 0.05);
        }
        
        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .plan-name {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .plan-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .plan-badge.recommended {
            background: var(--accent-primary);
            color: var(--bg-dark);
        }
        
        .plan-badge.warning {
            background: var(--accent-warning);
            color: var(--bg-dark);
        }
        
        .plan-badge.danger {
            background: var(--accent-danger);
            color: var(--text-primary);
        }
        
        .plan-specs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .spec {
            text-align: center;
        }
        
        .spec-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        
        .spec-value {
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
        }
        
        .utilization-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .utilization-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.5s ease;
        }
        
        .utilization-fill.warning {
            background: linear-gradient(90deg, var(--accent-warning), var(--accent-danger));
        }
        
        .utilization-fill.danger {
            background: var(--accent-danger);
        }
        
        .cost-summary {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 204, 255, 0.1));
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .cost-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .cost-row:last-child {
            border-bottom: none;
            padding-top: 1.5rem;
            margin-top: 0.5rem;
            border-top: 2px solid var(--accent-primary);
        }
        
        .cost-label {
            color: var(--text-secondary);
        }
        
        .cost-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .assumptions {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(139, 146, 167, 0.05);
            border-left: 4px solid var(--accent-secondary);
            border-radius: 4px;
        }
        
        .assumptions h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--accent-secondary);
        }
        
        .assumptions ul {
            list-style: none;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .assumptions li {
            padding: 0.25rem 0;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .assumptions li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent-secondary);
        }
        
        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .metric-grid {
                grid-template-columns: 1fr;
            }
            
            .plan-specs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>n8n - whatsapp Capacity Calculator</h1>
            <p class="subtitle">Real-time shift matching at Uber scale — Calculate your infrastructure needs</p>
        </header>
        
        <div class="grid">
            <!-- Input Panel -->
            <div class="card">
                <h2>Input Parameters</h2>
                
                <div class="input-group">
                    <label for="concurrent">
                        Concurrent Conversations
                        <span class="value-display" id="concurrentValue">20</span>
                    </label>
                    <input type="range" id="concurrent" value="20" min="5" max="500" step="5" class="slider">
                    <div class="help-text">
                        <strong>What this means:</strong> How many users are actively messaging your platform at the same time (per second). Like Uber showing "500 riders nearby" - this is your real-time load.
                        <div class="example">Example: 20 = Small market, 100 = Medium city, 500 = Major metro</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="conversion">
                        Shift Conversion Rate
                        <span class="value-display" id="conversionValue">30%</span>
                    </label>
                    <input type="range" id="conversion" value="30" min="10" max="80" step="5" class="slider">
                    <div class="help-text">
                        <strong>What this means:</strong> Percentage of conversations that end with a successful shift match. Not every chat results in a booking - this accounts for browsing, questions, and failed matches.
                        <div class="example">Example: 30% = 3 out of 10 conversations book a shift</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="aiTime">
                        AI Processing Time
                        <span class="value-display" id="aiTimeValue">3.0s</span>
                    </label>
                    <input type="range" id="aiTime" value="3" min="1" max="15" step="0.5" class="slider">
                    <div class="help-text">
                        <strong>What this means:</strong> How long each AI call takes to understand and respond to a message. Faster = more throughput.
                        <div class="example">GPT-3.5 Turbo: 2-3s | GPT-4: 8-12s | Local models: 10-15s</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="peakHours">
                        Peak Hours per Day
                        <span class="value-display" id="peakHoursValue">4 hours</span>
                    </label>
                    <input type="range" id="peakHours" value="4" min="2" max="12" step="1" class="slider">
                    <div class="help-text">
                        <strong>What this means:</strong> How many hours per day you operate at maximum capacity. Typically morning rush (7-9am) and evening (5-7pm). Rest of day runs at 30% capacity.
                        <div class="example">Example: 4 hours = Morning & evening peaks | 8 hours = Business hours | 12 hours = All day</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="deployment">Deployment Type</label>
                    <select id="deployment" class="select-input">
                        <option value="cloud">n8n Cloud (Managed)</option>
                        <option value="selfhosted">Self-Hosted (Docker)</option>
                    </select>
                    <div class="help-text">
                        <strong>Cloud:</strong> Fully managed, no DevOps needed, higher cost
                        <br><strong>Self-Hosted:</strong> More control, lower cost, requires technical setup
                    </div>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div>
                <!-- Formula Visualization -->
                <div class="formula-section">
                    <h2 class="formula-title">Mathematical Flow: Conversations → Shifts</h2>
                    
                    <div class="formula-flow">
                        <div class="formula-step">
                            <div class="formula-label">AI Calls/Min</div>
                            <div class="formula-calc" id="formulaStep1">(C × 60) ÷ T</div>
                            <div class="formula-result" id="resultStep1">400</div>
                        </div>
                        
                        <div class="formula-arrow">↓</div>
                        
                        <div class="formula-step">
                            <div class="formula-label">Shifts/Min</div>
                            <div class="formula-calc" id="formulaStep2">(AI_calls × R%) ÷ 4</div>
                            <div class="formula-result" id="resultStep2">30</div>
                        </div>
                        
                        <div class="formula-arrow">↓</div>
                        
                        <div class="formula-step">
                            <div class="formula-label">Shifts/Hour</div>
                            <div class="formula-calc" id="formulaStep3">Shifts/min × 60</div>
                            <div class="formula-result" id="resultStep3">1,800</div>
                        </div>
                        
                        <div class="formula-arrow">↓</div>
                        
                        <div class="formula-step">
                            <div class="formula-label">Shifts/Day</div>
                            <div class="formula-calc" id="formulaStep4">(S/h × Peak) + (S/h × 0.3 × OffPeak)</div>
                            <div class="formula-result" id="resultStep4">18,000</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(0, 204, 255, 0.05); border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                            Where: C = Concurrent, T = AI Time, R = Conversion Rate
                        </div>
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: var(--accent-secondary);">
                            4 messages/shift average (post + responses + confirmations)
                        </div>
                    </div>
                </div>
                
                <div class="card">
                <h2>Capacity Metrics</h2>
                
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-label">Shifts per Minute</div>
                        <div class="metric-value" id="shiftsPerMin">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Shifts per Hour</div>
                        <div class="metric-value" id="shiftsPerHour">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Shifts per Day</div>
                        <div class="metric-value" id="shiftsPerDay">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Monthly Volume</div>
                        <div class="metric-value" id="shiftsPerMonth">0</div>
                    </div>
                </div>
                
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-label">Messages per Minute</div>
                        <div class="metric-value" id="messagesPerMin">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Daily Messages</div>
                        <div class="metric-value" id="messagesPerDay">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">AI Calls per Minute</div>
                        <div class="metric-value" id="aiPerMin">0</div>
                    </div>
                    
                    <div class="metric">
                        <div class="metric-label">Daily AI Calls</div>
                        <div class="metric-value" id="aiPerDay">0</div>
                    </div>
                </div>
                
                <!-- n8n Plan Comparison -->
                <div class="plan-comparison">
                    <h2 style="margin-bottom: 1.5rem;">n8n Plan Requirements</h2>
                    
                    <div id="planCards"></div>
                </div>
                
                <!-- Cost Summary -->
                <div class="cost-summary" id="costSummary"></div>
                </div>
            </div>
        </div>
        
        <!-- Assumptions -->
        <div class="assumptions">
            <h3>Calculation Assumptions</h3>
            <ul>
                <li>Each conversation = 1 customer posting shift + worker responses</li>
                <li>Average 3-5 workers respond per shift (wave-based matching)</li>
                <li>Each message requires 1 AI call for intent detection</li>
                <li>Peak hours run at 100% capacity, off-peak at 30%</li>
                <li>n8n concurrency = 10 per worker (default setting)</li>
                <li>WhatsApp rate limit: 80 msg/sec (upgradable to 1,000)</li>
                <li>Each shift = ~6 total messages (post + responses + confirmations)</li>
            </ul>
        </div>
    </div>
    
    <script>
        const n8nPlans = {
            cloud: [
                {
                    name: "Starter",
                    executions: 2500,
                    cost: 20,
                    workers: 1,
                    concurrency: 10,
                    description: "Small team testing"
                },
                {
                    name: "Pro",
                    executions: 10000,
                    cost: 50,
                    workers: 1,
                    concurrency: 10,
                    description: "Growing business"
                },
                {
                    name: "Business",
                    executions: 100000,
                    cost: 500,
                    workers: 3,
                    concurrency: 30,
                    description: "High-volume operations"
                },
                {
                    name: "Enterprise",
                    executions: 1000000,
                    cost: 2000,
                    workers: 10,
                    concurrency: 100,
                    description: "Unlimited scale"
                }
            ],
            selfhosted: [
                {
                    name: "Small (2 workers)",
                    executions: 999999999,
                    cost: 300,
                    workers: 2,
                    concurrency: 20,
                    description: "2 CPU, 8GB RAM"
                },
                {
                    name: "Medium (4 workers)",
                    executions: 999999999,
                    cost: 500,
                    workers: 4,
                    concurrency: 40,
                    description: "4 CPU, 16GB RAM"
                },
                {
                    name: "Large (10 workers)",
                    executions: 999999999,
                    cost: 900,
                    workers: 10,
                    concurrency: 100,
                    description: "8 CPU, 32GB RAM"
                },
                {
                    name: "XLarge (20 workers)",
                    executions: 999999999,
                    cost: 1500,
                    workers: 20,
                    concurrency: 200,
                    description: "16 CPU, 64GB RAM"
                }
            ]
        };
        
        function calculate() {
            // Get inputs
            const concurrent = parseInt(document.getElementById('concurrent').value) || 0;
            const conversion = parseInt(document.getElementById('conversion').value) || 0;
            const aiTime = parseFloat(document.getElementById('aiTime').value) || 0;
            const peakHours = parseInt(document.getElementById('peakHours').value) || 0;
            const deployment = document.getElementById('deployment').value;
            
            // Update value displays
            document.getElementById('concurrentValue').textContent = concurrent;
            document.getElementById('conversionValue').textContent = conversion + '%';
            document.getElementById('aiTimeValue').textContent = aiTime.toFixed(1) + 's';
            document.getElementById('peakHoursValue').textContent = peakHours + ' hours';
            
            // Calculate concurrent AI capacity needed
            const concurrentAICalls = concurrent;
            
            // Step 1: Calculate AI calls per minute
            const aiCallsPerMin = concurrent * 60 / aiTime;
            
            // Step 2: Calculate shifts per minute
            const shiftsPerMin = (aiCallsPerMin * (conversion / 100)) / 4; // 4 AI calls per shift avg
            
            // Step 3: Calculate per hour
            const shiftsPerHour = shiftsPerMin * 60;
            
            // Step 4: Calculate messages per minute
            const messagesPerMin = concurrent * 60 / aiTime * 6; // 6 messages per shift total
            
            // Step 5: Daily calculation (peak hours at 100%, off-peak at 30%)
            const offPeakHours = 24 - peakHours;
            const shiftsPerDay = (shiftsPerHour * peakHours) + (shiftsPerHour * 0.3 * offPeakHours);
            const messagesPerDay = (messagesPerMin * 60 * peakHours) + (messagesPerMin * 60 * 0.3 * offPeakHours);
            const aiPerDay = messagesPerDay; // 1 AI call per message
            
            // Monthly
            const shiftsPerMonth = shiftsPerDay * 30;
            
            // Update formula visualization
            document.getElementById('formulaStep1').textContent = `(${concurrent} × 60) ÷ ${aiTime} = AI calls/min`;
            document.getElementById('resultStep1').textContent = Math.round(aiCallsPerMin).toLocaleString();
            
            document.getElementById('formulaStep2').textContent = `(${Math.round(aiCallsPerMin).toLocaleString()} × ${conversion}%) ÷ 4 = shifts/min`;
            document.getElementById('resultStep2').textContent = Math.round(shiftsPerMin).toLocaleString();
            
            document.getElementById('formulaStep3').textContent = `${Math.round(shiftsPerMin).toLocaleString()} × 60 = shifts/hour`;
            document.getElementById('resultStep3').textContent = Math.round(shiftsPerHour).toLocaleString();
            
            document.getElementById('formulaStep4').textContent = `(${Math.round(shiftsPerHour).toLocaleString()} × ${peakHours}) + (${Math.round(shiftsPerHour).toLocaleString()} × 0.3 × ${offPeakHours})`;
            document.getElementById('resultStep4').textContent = Math.round(shiftsPerDay).toLocaleString();
            
            // Update UI
            document.getElementById('shiftsPerMin').textContent = Math.round(shiftsPerMin).toLocaleString();
            document.getElementById('shiftsPerHour').textContent = Math.round(shiftsPerHour).toLocaleString();
            document.getElementById('shiftsPerDay').textContent = Math.round(shiftsPerDay).toLocaleString();
            document.getElementById('shiftsPerMonth').textContent = Math.round(shiftsPerMonth).toLocaleString();
            document.getElementById('messagesPerMin').textContent = Math.round(messagesPerMin).toLocaleString();
            document.getElementById('messagesPerDay').textContent = Math.round(messagesPerDay).toLocaleString();
            document.getElementById('aiPerMin').textContent = Math.round(aiCallsPerMin).toLocaleString();
            document.getElementById('aiPerDay').textContent = Math.round(aiPerDay).toLocaleString();
            
            // Calculate plan requirements
            renderPlans(concurrentAICalls, messagesPerDay, deployment, aiPerDay);
        }
        
        function renderPlans(requiredConcurrency, messagesPerDay, deployment, aiPerDay) {
            const plans = n8nPlans[deployment];
            const planCardsContainer = document.getElementById('planCards');
            planCardsContainer.innerHTML = '';
            
            let recommendedPlan = null;
            
            plans.forEach(plan => {
                const utilization = (requiredConcurrency / plan.concurrency) * 100;
                const isCapable = plan.concurrency >= requiredConcurrency;
                const isOptimal = utilization >= 30 && utilization <= 70;
                
                let status = 'danger';
                let badge = 'Insufficient';
                
                if (isCapable) {
                    if (isOptimal) {
                        status = 'recommended';
                        badge = 'Recommended';
                        if (!recommendedPlan) recommendedPlan = plan;
                    } else if (utilization < 30) {
                        status = 'warning';
                        badge = 'Over-provisioned';
                    } else if (utilization <= 90) {
                        status = 'recommended';
                        badge = 'Good Fit';
                        if (!recommendedPlan) recommendedPlan = plan;
                    } else {
                        status = 'warning';
                        badge = 'Near Capacity';
                    }
                }
                
                const planCard = document.createElement('div');
                planCard.className = `plan-card ${status}`;
                planCard.innerHTML = `
                    <div class="plan-header">
                        <div class="plan-name">${plan.name}</div>
                        <div class="plan-badge ${status}">${badge}</div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">
                        ${plan.description}
                    </div>
                    <div class="plan-specs">
                        <div class="spec">
                            <div class="spec-label">Workers</div>
                            <div class="spec-value">${plan.workers}</div>
                        </div>
                        <div class="spec">
                            <div class="spec-label">Concurrency</div>
                            <div class="spec-value">${plan.concurrency}</div>
                        </div>
                        <div class="spec">
                            <div class="spec-label">Monthly Cost</div>
                            <div class="spec-value">$${plan.cost}</div>
                        </div>
                    </div>
                    <div class="utilization-bar">
                        <div class="utilization-fill ${utilization > 90 ? 'danger' : utilization > 70 ? 'warning' : ''}" 
                             style="width: ${Math.min(100, utilization)}%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">
                        Utilization: ${Math.round(utilization)}%
                    </div>
                `;
                planCardsContainer.appendChild(planCard);
            });
            
            // Render cost summary
            if (recommendedPlan) {
                renderCostSummary(recommendedPlan, aiPerDay, messagesPerDay);
            }
        }
        
        function renderCostSummary(plan, aiPerDay, messagesPerDay) {
            const costSummary = document.getElementById('costSummary');
            
            // Calculate costs
            const n8nCost = plan.cost;
            const aiCost = (aiPerDay * 30 * 0.002); // $0.002 per AI call (GPT-3.5)
            const whatsappCost = (messagesPerDay * 30 * 0.008); // $0.008 per message
            const infraCost = 150; // DB, Redis, hosting
            const totalCost = n8nCost + aiCost + whatsappCost + infraCost;
            
            costSummary.innerHTML = `
                <!-- <h2 style="margin-bottom: 1rem; color: var(--accent-primary);">Monthly Cost Estimate</h2>
                <div class="cost-row">
                    <div class="cost-label">n8n (${plan.name})</div>
                    <div class="cost-value">$${n8nCost.toLocaleString()}</div>
                </div>
                <div class="cost-row">
                    <div class="cost-label">OpenAI API (${(aiPerDay * 30).toLocaleString()} calls)</div>
                    <div class="cost-value">$${Math.round(aiCost).toLocaleString()}</div>
                </div>
                <div class="cost-row">
                    <div class="cost-label">WhatsApp API (${(messagesPerDay * 30).toLocaleString()} msgs)</div>
                    <div class="cost-value">$${Math.round(whatsappCost).toLocaleString()}</div>
                </div>
                <div class="cost-row">
                    <div class="cost-label">Infrastructure (DB, Redis, Hosting)</div>
                    <div class="cost-value">$${infraCost}</div>
                </div>
                <div class="cost-row">
                    <div class="cost-label" style="font-weight: 700; color: var(--text-primary);">Total Monthly Cost</div>
                    <div class="cost-value" style="font-size: 1.5rem; color: var(--accent-primary);">$${Math.round(totalCost).toLocaleString()}</div>
                </div> -->
            `;
        }
        
        // Event listeners - use 'input' for real-time slider updates
        document.getElementById('concurrent').addEventListener('input', calculate);
        document.getElementById('conversion').addEventListener('input', calculate);
        document.getElementById('aiTime').addEventListener('input', calculate);
        document.getElementById('peakHours').addEventListener('input', calculate);
        document.getElementById('deployment').addEventListener('change', calculate);
        
        // Initial calculation
        calculate();
    </script>
</body>
</html>